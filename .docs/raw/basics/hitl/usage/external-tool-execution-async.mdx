---
title: External Tool Execution Async
sidebarTitle: External Execution (Async)
keywords: [external execution, async, external_tool_execution, shell command]
description: This example demonstrates how to execute tools outside of the agent using external tool execution in an asynchronous environment. This pattern allows you to control tool execution externally while maintaining agent functionality with async operations.
mode: wide
---

<Steps>

  <Step title="Create a Python file">
    Create a Python file and add the above code.
    ```bash
    touch external_tool_execution_async.py
    ```
  </Step>


  <Step title="Add the following code to your Python file">
    ```python external_tool_execution_async.py
    import asyncio
    import subprocess

    from agno.agent import Agent
    from agno.db.sqlite import SqliteDb
    from agno.models.openai import OpenAIChat
    from agno.tools import tool
    from agno.utils import pprint


    # We have to create a tool with the correct name, arguments and docstring for the agent to know what to call.
    @tool(external_execution=True)
    def execute_shell_command(command: str) -> str:
        """Execute a shell command.

        Args:
            command (str): The shell command to execute

        Returns:
            str: The output of the shell command
        """
        if command.startswith("ls"):
            return subprocess.check_output(command, shell=True).decode("utf-8")
        else:
            raise Exception(f"Unsupported command: {command}")


    agent = Agent(
        model=OpenAIChat(id="gpt-4o-mini"),
        tools=[execute_shell_command],
        markdown=True,
        db=SqliteDb(session_table="test_session", db_file="tmp/example.db"),
    )

    run_response = asyncio.run(agent.arun("What files do I have in my current directory?"))
    if run_response.is_paused:
        for requirement in run_response.active_requirements:
            if requirement.needs_external_execution:
                if requirement.tool_execution.tool_name == execute_shell_command.name:
                    print(
                        f"Executing {requirement.tool_execution.tool_name} with args {requirement.tool_execution.tool_args} externally"
                    )
                    # We execute the tool ourselves. You can also execute something completely external here.
                    result = execute_shell_command.entrypoint(
                        **requirement.tool_execution.tool_args
                    )  # type: ignore
                    # We have to set the result on the tool execution object so that the agent can continue
                    requirement.set_external_execution_result(result)

    run_response = asyncio.run(
        agent.acontinue_run(
            run_id=run_response.run_id,
            requirements=run_response.requirements,
        )
    )
    pprint.pprint_run_response(run_response)


    # Or for simple debug flow
    # agent.print_response("What files do I have in my current directory?")

    ```
  </Step>

  <Snippet file="create-venv-step.mdx" />

  <Step title="Install libraries">
    ```bash
    pip install -U agno openai
    ```
  </Step>

  <Step title="Export your OpenAI API key">

    <CodeGroup>

    ```bash Mac/Linux
      export OPENAI_API_KEY="your_openai_api_key_here"
    ```

    ```bash Windows
      $Env:OPENAI_API_KEY="your_openai_api_key_here"
    ```
    </CodeGroup>
  </Step>

  <Step title="Run Agent">
    <CodeGroup>
    ```bash Mac
    python external_tool_execution_async.py
    ```

    ```bash Windows
    python external_tool_execution_async.py
    ```
    </CodeGroup>
  </Step>

  <Step title="Find All Cookbooks">
  Explore all the available cookbooks in the Agno repository. Click the link below to view the code on GitHub:

  <Link href="https://github.com/agno-agi/agno/tree/main/cookbook/03_agents/human_in_the_loop" target="_blank">
    Agno Cookbooks on GitHub
  </Link>
</Step>
</Steps>
